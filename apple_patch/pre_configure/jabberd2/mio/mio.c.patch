--- /tmp/jabberd-2.1.24.1/mio/mio.c	2008-04-27 02:57:33.000000000 -0700
+++ ./jabberd2/mio/mio.c	2009-01-25 20:37:19.000000000 -0800
@@ -31,6 +31,7 @@
 
 
 mio_t mio_epoll_new(int maxfd);
+mio_t mio_kqueue_new(int maxfd);
 mio_t mio_poll_new(int maxfd);
 mio_t mio_select_new(int maxfd);
 mio_t mio_wsasync_new(int maxfd);
@@ -44,6 +45,11 @@ mio_t mio_new(int maxfd)
   if (m != NULL) return m;
 #endif
 
+#ifdef MIO_KQUEUE
+  m = mio_kqueue_new(maxfd);
+  if (m != NULL) return m;
+#endif
+
 #ifdef MIO_WSASYNC
   m = mio_wsasync_new(maxfd);
   if (m != NULL) return m;
